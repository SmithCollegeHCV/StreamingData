<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<p style = "text-align:center">
	<img src = "logo-small.png" width = "150px"/>
	<div class = "content">
	</p>
	<p style = "text-align:center">
		Thank you for agreeing to participate in this research study. <br/> During this experiment, you will be shown a series of patterns...
	</p>
	<p class = "instruction" style = "text-align:center">
		Press &#8592 to go back &#8195 &#8195 &#8195 &#8195 &#8195 &#8195 &#8195 Press &#x2192 to continue
	</p>
</div>

<style>
p{
	font-family: verdana;
	font-size: 20px;
	padding
}
.instruction{
	color:#B5B5B4;
}
.content{
	width:800;
	margin-left:auto;
	margin-right:auto;
}
.axis path,
.axis line{
	fill:none;
	stroke:black;
	shape-rendering: crispEdges;

}

.line{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.model{
	fill: none;
	stroke: #B5B5B4;
	stroke-width: 2px;
}
.text{
	text-anchor:middle;
	font-family: verdana;
	
}
#lineCopy{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.lineClick{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}

</style>
<script>
window.addEventListener("keydown", checkKeyPressed, false);
var step = -1;
//console.log(step);
function checkKeyPressed(e) {
	if (e.keyCode == "39") {
		step += 1;
		e.preventDefault();
		d3.select(".line")
		.remove();
		d3.select("text")
		.remove();
		d3.select(".text")
		.remove();
		d3.select("#lineCopy")
		.remove();
		var model =  d3.select(".model")
		.remove();
		update(step);
    //console.log(step);
}
if (e.keyCode == "37") {
	step -= 1;
	e.preventDefault();
	d3.select(".line")
	.remove();
	d3.select("text")
	.remove();
	d3.select(".text")
	.remove();
	d3.select(".model")
	.remove();
	d3.select("#lineCopy")
	.remove();
	update(step);
    //console.log(step);
}    	
}

var n = 10;
var duration = 300000;
var x = d3.scale.linear()
.domain([0,n-1])
.range([0,350]);
var y = d3.scale.linear()
.domain([-0.6,0.6])
.range([200,0]);
var xModel = d3.scale.linear()
.domain([0,10])
.range([0,200]);
var yModel = d3.scale.linear()
.domain([-0.6,0.6])
.range([100,0]);
var svg = d3.select("#experimentr")
.append("svg:svg")
		//.attr("id","svg")
		//.attr("align","center")
		.attr("width",720)
		.attr("height",400)
		.append("g");
		d3.select("body").attr("align","center");

		var xDouble = d3.scale.linear()
		.domain([0,n-1])
		.range([0,300]);
/*svg.append("g")
	.attr("class","x axis")
	.attr("transform","translate(240," + y(0)+")")
	.call(d3.svg.axis().scale(x).orient("bottom"));*/
	var data0 = [{"x":0, "y":0.25},{"x":1, "y":-0.25},{"x":2, "y":0.25},{"x":3, "y":-0.25},{"x":4, "y":0.25},{"x":5, "y":-0.25},{"x":6, "y":0.25},{"x":7, "y":-0.25},{"x":8, "y":0.25},{"x":9, "y":-0.25}];
	var	data1 = [{"x":0, "y":-0.25},{"x":1, "y":0.25},{"x":2, "y":-0.15},{"x":3, "y":0.15},{"x":4, "y":-0.2},{"x":5, "y":0.25},{"x":6, "y":-0.3},{"x":7, "y":0.15},{"x":8, "y":-0.1},{"x":9, "y":0}];
	var	data3 = [{"x":0, "y":0.25},{"x":0.5, "y":-0.25},{"x":1, "y":0.25},{"x":1.5, "y":-0.25},{"x":2, "y":0.25},{"x":2.5, "y":-0.25},{"x":3.5, "y":0.25},{"x":4.5, "y":-0.25},{"x":5.5, "y":0.25},{"x":6.5, "y":-0.25}];
	var	data2 = [{"x":0, "y":0.25},{"x":1, "y":-0.25},{"x":2, "y":1},{"x":3, "y":-0.25},{"x":4, "y":0.25},{"x":5, "y":-0.5},{"x":6, "y":0.25},{"x":7, "y":-0.25},{"x":8, "y":0.25},{"x":9, "y":-0.25}];
	var dataSet = [data0,data1,data2,data3];
//console.log(dataSet);


function update(i){

	svg.selectAll("text").remove();

	if (i <=3 ){
//console.log("sddfd");
var fileName = "data/file"+i+".tsv";
var modelName = "data"+i;
//console.log(fileName);
d3.tsv(fileName, type, function(error,data){
	//console.log(dataSet);
	var line = d3.svg.line()
	.x(function(d,i){return x(d.index);})
	.y(function(d,i){return y(d.value);})
	.interpolate("basis");
	var path = svg.append("g")
	.append("path")
		//.attr("transform","translate(0,50)")
		.datum(data)
		.attr("class","line")
		.attr("d",line)
		.transition()
		.duration(duration)
		.ease("linear")
		.attr("transform","translate("+x(-1999) + ",0)");
	/*var modelLine = d3.svg.line()
		.x(function(d,i){return xModel(d.x);})
		.y(function(d,i){return yModel(d.y);})
		.interpolate("basis");
	var modelPath = svg.append("g")
		.append("path")
		.attr("transform","translate(300,0)")
		.attr("class","model")
		//.datum(data0)
		.attr("d",modelLine(dataSet[i]));*/
	})	
var stringList = ["This is a normal pattern", "This is also a normal pattern","There might be some values that look odd.","Sometimes the pattern might stretch or compress."];
var string = svg.append("text")
.attr("class","text")
.text(stringList[i])
.attr("x",360)
.attr("y",250)
.attr("font-size","20px")
.attr("fill","#B5B5B4");
//console.log(string);

if (i == 2) {
	svg.append("text")
	.attr("class","text")
	.text("This is an ANOMALY.")
	.attr("x",360)
	.attr("y",280)
	.attr("font-size","20px")
	.attr("fill","#B5B5B4");
} else if (i == 3) {
	svg.append("text")
	.attr("class","text")
	.text("This is ALSO an ANOMALY.")
	.attr("x",360)
	.attr("y",280)
	.attr("font-size","20px")
	.attr("fill","#B5B5B4");
}

}
else {
	if (i == 4){
		d3.tsv("data/file3.tsv", type, function(error,data){
	//console.log(dataSet);
	var line = d3.svg.line()
	.x(function(d,i){return x(d.index);})
	.y(function(d,i){return y(d.value);})
	.interpolate("basis");
	var path = svg.append("g")
	.attr("clip-path","url(#clip)")
		//.attr("id","path")
		.append("path")
		.attr("transform","translate(0,0)")
		.datum(data)
		.attr("class","line")
		.attr("d",line)
		.transition()
		.duration(duration)
		.ease("linear")
		.attr("transform","translate("+x(-1999) + ",0)");

		svg.append("text")
		.attr("class","text")
		.text("Whenever you see an ANOMALY")
		.attr("x",360)
		.attr("y",250)
		.attr("font-size","20px")
		.attr("fill","#B5B5B4");

		svg.append("text")
		.attr("class","text")
		.text("(shrinking, stretching or odd-looking value),")
		.attr("x",360)
		.attr("y",280)
		.attr("font-size","20px")
		.attr("fill","#B5B5B4");

		svg.append("text")
		.attr("class","text")
		.text("press the ENTER key, SPACEBAR, or click your mouse")
		.attr("x",360)
		.attr("y",310)
		.attr("font-size","20px")
		.attr("fill","#B5B5B4");
	})

}
if (i == 5){
	svg.append("text")
	.attr("class","text")
	.attr("x",360)
	.attr("y",100)
	.attr("font-size","20px")
	.attr("fill","black")
	.text("There will be three different lines in each test");
	svg.append("text")
	.attr("class","text")
	.attr("x",360)
	.attr("y",150)
	.attr("font-size","20px")
	.attr("fill","black")
	.text("Each test will take 5 minites to finish");
}

}


}
function type(d){
	d.index = +d.index;
	d.value = +d.value;
	return d;
}

</script>

