<link rel="stylesheet" type="text/css" href="modules/mainExp.css">
<style>
p{
	font-family: verdana;
	font-size: 20px;
	text-align:center;
}

.content{
	width:800;
	margin-left:auto;
	margin-right:auto;
}

.line{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}

svg text{
	text-anchor:middle;
	font-family: verdana;
	fill: black;
	font-size:20px;
}
</style>

<body>
<p style = "text-align:center">
<img src = "logo-small.png" width = "150px"/>
<div class = "content">
</p>
<p style = "text-align:center">
Thank you for agreeing to participate in this research study.</p>
<p class = "instruction" style = "text-align:center">
During this experiment, you will be shown a series of patterns...
</p>
<p class = "instruction" id = "back-button" style = "color:#BBB; float:left;">
 Press &#8592 key to go back
</p>

<p class = "instruction" id = "forward-button" style = "color:#BBB; float:right;">
Press &#x2192 key to continue
</p>
</div>
<script>


Mousetrap.bind('left', function(e, n) { checkKeyPressed(n); });
Mousetrap.bind('right',function(e, n) { checkKeyPressed(n); });

experimentr.hideNext();

var step = 0;

function checkKeyPressed(key) { 

    if ((key == "right") && (step < 7)) {
    	step += 1;
    	update(step);
    }
    else if ((key == "left") && (step  > 0)){
    	step -= 1;
    	update(step);
    	d3.select()
    }  
}
  
var n = 10;
var duration = 200000;

var x = d3.scale.linear()
		.domain([0,40])
		.range([0,350]);

var x2 = d3.scale.linear()
		.domain([0,10])
		.range([0,350]);			
var y = d3.scale.linear()
		.domain([-0.6,0.6])
		.range([200,0]);

var y1 = d3.scale.linear()
	.domain([-2.5, 2.5])
	.range([150, 50]);

var y2 = d3.scale.linear()
	.domain([-2.5, 2.5])
	.range([250, 150]);

var y3 = d3.scale.linear()
	.domain([-2.5, 2.5])
	.range([350, 250]);

var svg = d3.select(".content")
		.append("svg:svg")
		.attr("id", "container")
		.attr("width",720)
		.attr("height",450)
		.append("g");
		
d3.select("body").attr("align","center");

update(step);


function update(i){
	console.log(i);
	svg.selectAll(".line")
    	.remove();
    svg.selectAll("text")
    	.remove();
    svg.selectAll("#line")
    	.remove();
    svg.selectAll("image")
    	.remove();
    	
    d3.select("#container").attr("height", 450);
    experimentr.hideNext();
    
    if (i == 0) {
    	d3.select("#back-button").style("visibility", "hidden");
    	d3.select("#forward-button").style("visibility", "visible");
    } else if (i == 9) {
    	d3.select("#back-button").style("visibility", "visible");
    	d3.select("#forward-button").style("visibility", "hidden");
    } else {
    	d3.select("#back-button").style("visibility", "visible");
    	d3.select("#forward-button").style("visibility", "visible");
    }
	
	

	if (i >=0 && i <=3 ){

		var fileName = "data/file"+i+".tsv";
		var modelName = "data"+i;

		d3.tsv(fileName, type, function(error,data){

			var line = d3.svg.line()
				.x(function(d,i){return x2(d.index);})
				.y(function(d,i){return y(d.value);})
				.interpolate("cardinal");
		
			var path = svg.append("g")
				.append("path")
				.datum(data)
				.attr("class","line")
				.attr("d",line)
				.transition()
					.duration(duration)
					.ease("linear")
					.attr("transform","translate("+x(-1999)+",0)");
		})	

		var stringList = ["This is a normal pattern.", "This is also a normal pattern.","There might be some values that look odd.","Sometimes the pattern might stretch or compress."];
	
		var string = svg.append("text")
					.text(stringList[i])
					.attr("x",360)
					.attr("y",250);

		if (i == 2) {

		svg.append("image")
			.attr("xlink:href", "modules/tutorial/anomaly.png")
      		.attr("width", 600)
      		.attr("height", 600)			
      		.attr("x",75)
			.attr("y",-70);


			svg.append("text")
				.text("This is an ANOMALY.")
				.attr("x",360)
				.attr("y",280);
		} 
		 if (i == 3) {
		 	svg.append("image")
			.attr("xlink:href", "modules/tutorial/compress.png")
      		.attr("width", 600)
      		.attr("height", 600)
      		.attr("x",75)
			.attr("y",-70);

			svg.append("text")
				.text("This is ALSO an ANOMALY.")
				.attr("x",360)
				.attr("y",280);
		}
	
	} else if (i == 4){

		var q = d3.queue();
q.defer(d3.tsv, "data/slow1.tsv")
q.defer(d3.tsv, "data/slow2.tsv")
q.defer(d3.tsv, "data/slow3.tsv")
.await(setUp); 


function setUp(error, data1, data2, data3){
	if (error) throw error;


	var disData1 = data1.slice(0,80);
	var disData2 = data2.slice(0,80);
	var disData3 = data3.slice(0,80);


	var line1  = d3.svg.line()
		.x(function(d,i){return x(i);})
		.y(function(d){ return  y1(parseFloat(d.value));})
		.interpolate("basis");

	var line2 = d3.svg.line()
		.x(function(d,i){return x(i);})
		.y(function(d){ return  y2(parseFloat(d.value));})
		.interpolate("basis");

	var line3 = d3.svg.line()
		.x(function(d,i){return x(i);})
		.y(function(d){ return  y3(parseFloat(d.value));})
		.interpolate("basis");

	var path1 =svg.append("g")
		.attr("clip-path","url(#clip)")
		.append("path")
		.datum(disData1)
		.attr("class","line1")
		.attr("id","line")
		.attr("d",line1);

	var path2 = svg.append("g")
		.attr("clip-path","url(#clip)")
		.append("path")
		.datum(disData2)
		.attr("class","line2")
		.attr("id","line")
		.attr("d",line2);

	var path3= svg.append("g")
		.attr("clip-path","url(#clip)")
		.append("path")
		.datum(disData3)
		.attr("class","line3")
		.attr("id","line")
		.attr("d",line3);

	svg.append("text")
		.text("During the experiment, you will be asked to monitor")
		.attr("x",360)
		.attr("y",370);

	svg.append("text")
		.text("3 lines simultaneously.")
		.attr("x",360)
		.attr("y",400)
		.style("font-weight", "bold");


	tick();

	function tick(){


		disData1.push(data1.slice(0,1)[0]);
		data1.splice(0,1);
		if(data1.length>=1){
			path1
				.attr("d",line1)
				.attr("transform",null)
				.transition()
				.duration(100)
				.ease("linear")
				.attr("transform", "translate(" + x(-1) + ",0)")
			disData1.shift();

			disData2.push(data2.slice(0,1)[0]);
			data2.splice(0,1);
			path2
				.attr("d",line2)
				.attr("transform",null)
				.transition()
				.duration(100)
				.ease("linear")
				.attr("transform", "translate(" + x(-1) + ",0)")
			disData2.shift();

			disData3.push(data3.slice(0,1)[0]);;
			data3.splice(0,1);
			path3
				.attr("d",line3)
				.attr("transform",null)
				.transition()
				.duration(100)
				.ease("linear")
				.attr("transform", "translate(" + x(-1) + ",0)")
				.each("end",tick);
			disData3.shift();
	}else{
		validate();
	}
	
	};

	


};



function validate() {
	experimentr.endTimer('demo');
	experimentr.release();
};
		
	  } else if (i == 5){
	
		// svg.append("text")
		// 		.text("Whenever you see an ANOMALY")
		// 		.attr("x",360)
		// 		.attr("y",50);
			
		// svg.append("text")
		// 		.text("(shrinking, stretching or odd-looking value),")
		// 		.attr("x",360)
		// 		.attr("y",80);
			
		// svg.append("text")
		// 		.text("press the ENTER key, SPACEBAR, or click your mouse.")
		// 		.attr("x",360)
		// 		.attr("y",110);


     	svg.append("image")
			.attr("xlink:href", "modules/tutorial/multiple.png")
      		.attr("width", 25)
      		.attr("height", 25)			
      		.attr("x",25)
			.attr("y", 25);

		// svg.append("text")
		// 		.text("You need only respond")
		// 		.attr("x",250)
		// 		.attr("y",280);
			
		// svg.append("text")
		// 		.text("ONCE per incident")
		// 		.attr("x",475)
		// 		.attr("y",450)
		// 		.style("font-weight", "bold");
			
		// svg.append("text")
		// 		.text("regardless of how many lines contain the anomaly.")
		// 		.attr("x",360)
		// 		.attr("y",500);
			
	} else if (i ==6){
		svg.append("image")
			.attr("xlink:href", "modules/tutorial/anomaly.png")
      		.attr("width", 600)
      		.attr("height", 600)			
      		.attr("x",75)
			.attr("y",-70);

		svg.append('text')
			.style("font-weight", "bold")
			.text("Here is an example of an anomaly you might see")
			.attr("x",360)
			.attr("y",50);

	}
	else {
	
		d3.select("#container").attr("height", 150);
		
		d3.select("body")
	
		svg.append("text")
				.style("font-weight", "bold")
				.text("This completes the tutorial.")
				.attr("x",360)
				.attr("y",50);
				
		svg.append("text")
				.text("When you are ready to begin the experiment,")
				.attr("x",360)
				.attr("y",80);
				
		svg.append("text")
				.text('please click the button "Next" below.')
				.attr("x",360)
				.attr("y",110);
				
		experimentr.showNext();
		experimentr.release();	
	
	}
}

function type(d){
	d.index = d.index;
	d.value = d.value;
	return d;
}

</script>
</body>
