<body>
<p style = "text-align:center">
<img src = "logo-small.png" width = "150px"/>
<div class = "content">
</p>
<p style = "text-align:center">
Thank you for agreeing to participate in this research study. <br/> During this experiment, you will be shown a series of patterns...
</p>
<p class = "instruction" style = "text-align:center">
 Press &#8592 to go back &#8195 &#8195 &#8195 &#8195 &#8195 &#8195 &#8195 Press &#x2192 to continue
</p>
</div>

<style>
p{
font-family: verdana;
font-size: 20px;
padding
}
.instruction{
color:#B5B5B4;
}
.content{
width:800;
margin-left:auto;
margin-right:auto;
}
.axis path,
.axis line{
	fill:none;
	stroke:black;
	shape-rendering: crispEdges;

}
p{
font-family: verdana;
font-size: 20px;
padding
}
.instruction{
color:#B5B5B4;
}
.content{
width:800;
margin-left:auto;
margin-right:auto;
}
.axis path,
.axis line{
	fill:none;
	stroke:black;
	shape-rendering: crispEdges;
}
.line{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.model{
	fill: none;
	stroke: #B5B5B4;
	stroke-width: 2px;
}
.text{
	text-anchor:middle;
	font-family: verdana;
	fill: black;
	
}
#lineCopy{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.lineClick{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.line2{
	fill: none;
	stroke: brown;
	stroke-width: 2px;
	
}
.line3{
	fill: none;
	stroke: steelblue;
	stroke-width: 2px;
	
}
.line{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.model{
	fill: none;
	stroke: #B5B5B4;
	stroke-width: 2px;
}
.text{
	text-anchor:middle;
	font-family: verdana;
	
}
#lineCopy{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}
.lineClick{
	fill: none;
	stroke: black;
	stroke-width: 2px;
}

</style>
<script>


Mousetrap.bind('left', function(e, n) { checkKeyPressed(n); });
Mousetrap.bind('right',function(e, n) { checkKeyPressed(n); });

experimentr.hideNext();

var step = -1;

function checkKeyPressed(key) {
	console.log('called function', key);
    if (key == "right") {
    step += 1;
    d3.select(".line")
    	.remove();
    d3.select("text")
    	.remove();
    d3.select(".text")
    	.remove();
    d3.select("#lineCopy")
    	.remove();
    d3.select(".line1")
    	.remove();
    d3.select(".line2")
    	.remove();
    d3.select(".line3")
    	.remove();
    var model =  d3.select(".model")
    	.remove();
    console.log('moving forward'+step);
    update(step);
   
    }
    if (key == "left") {
    step -= 1;
    d3.select(".line")
    	.remove();
    d3.select("text")
    	.remove();
    d3.select(".text")
    	.remove();
    d3.select(".model")
    	.remove();
    d3.select("#lineCopy")
    	.remove();
    d3.select(".line1")
    	.remove();
    d3.select(".line2")
    	.remove();
    d3.select(".line3")
    	.remove();
   	console.log('moving back' + step);
    update(step);
    
    }  
 	
    }
  
var n = 10;
var duration = 600000;
var x = d3.scale.linear()
		.domain([0,n-1])
		.range([0,350]);
var y = d3.scale.linear()
		.domain([-0.6,0.6])
		.range([200,0]);
var xModel = d3.scale.linear()
		.domain([0,10])
		.range([0,200]);
var yModel = d3.scale.linear()
		.domain([-0.6,0.6])
		.range([100,0]);
var svg = d3.select(".content")
		.append("svg:svg")
		.attr("id", "container")
		.attr("width",720)
		.attr("height",450)
		.append("g");
d3.select("body").attr("align","center");

var xDouble = d3.scale.linear()
		.domain([0,n-1])
		.range([0,300]);

var data0 = [{"x":0, "y":0.25},{"x":1, "y":-0.25},{"x":2, "y":0.25},{"x":3, "y":-0.25},{"x":4, "y":0.25},{"x":5, "y":-0.25},{"x":6, "y":0.25},{"x":7, "y":-0.25},{"x":8, "y":0.25},{"x":9, "y":-0.25}];
var	data1 = [{"x":0, "y":-0.25},{"x":1, "y":0.25},{"x":2, "y":-0.15},{"x":3, "y":0.15},{"x":4, "y":-0.2},{"x":5, "y":0.25},{"x":6, "y":-0.3},{"x":7, "y":0.15},{"x":8, "y":-0.1},{"x":9, "y":0}];
var	data3 = [{"x":0, "y":0.25},{"x":1, "y":-0.25},{"x":2, "y":1},{"x":3, "y":-0.25},{"x":4, "y":0.25},{"x":5, "y":-0.5},{"x":6, "y":0.25},{"x":7, "y":-0.25},{"x":8, "y":0.25},{"x":9, "y":-0.25}];
var	data2 = [{"x":0, "y":0.25},{"x":0.5, "y":-0.25},{"x":1, "y":0.25},{"x":1.5, "y":-0.25},{"x":2, "y":0.25},{"x":2.5, "y":-0.25},{"x":3.5, "y":0.25},{"x":4.5, "y":-0.25},{"x":5.5, "y":0.25},{"x":6.5, "y":-0.25}];
var dataSet = [data0,data1,data2,data3];


function update(i){
console.log(i);
svg.selectAll("text").remove();

if (i >=0 && i <=3 ){

//console.log("sddfd");
var fileName = "data/file"+i+".tsv";
var modelName = "data"+i;
//console.log(fileName);
d3.tsv(fileName, type, function(error,data){
	//console.log(dataSet);
	var line = d3.svg.line()
		.x(function(d,i){return x(d.index);})
		.y(function(d,i){return y(d.value);})
		.interpolate("cardinal");
	var path = svg.append("g")
		.append("path")
		//.attr("transform","translate(0,50)")
		.datum(data)
		.attr("class","line")
		.attr("d",line)
		.transition()
		.duration(duration)
		.ease("linear")
		.attr("transform","translate("+x(-1999)+",0)");
	
})	
var stringList = ["This is a normal pattern", "This is also a normal pattern","There might be some values that look odd.","Sometimes the pattern might stretch or compress."];
var string = svg.append("text")
			.attr("class","text")
			.text(stringList[i])
			.attr("x",360)
			.attr("y",250)
			.attr("font-size","20px");
//			.attr("fill","#B5B5B4");
//console.log(string);

	if (i == 2) {
		svg.append("text")
		.attr("class","text")
			.text("This is an ANOMALY.")
			.attr("x",360)
			.attr("y",280)
			.attr("font-size","20px");
//			.attr("fill","#B5B5B4");
	} else if (i == 3) {
		svg.append("text")
		.attr("class","text")
			.text("This is ALSO an ANOMALY.")
			.attr("x",360)
			.attr("y",280)
			.attr("font-size","20px");
//			.attr("fill","#B5B5B4");
	}

}
else {
	if (i == 5){
	/*d3.tsv("data/file3.tsv", type, function(error,data){
	//console.log(dataSet);
	var line = d3.svg.line()
		.x(function(d,i){return x(d.index);})
		.y(function(d,i){return y(d.value);})
		.interpolate("cardinal");
	var path = svg.append("g")
		.attr("clip-path","url(#clip)")
		//.attr("id","path")
		.append("path")
		.attr("transform","translate(0,0)")
		.datum(data)
		.attr("class","line")
		.attr("d",line)
		.transition()
		.duration(duration)
		.ease("linear")
		.attr("transform","translate("+x(-1999) +",0)");*/
	
	svg.append("text")
			.attr("class","text")
			.text("Whenever you see an ANOMALY")
			.attr("x",360)
			.attr("y",50)
			.attr("font-size","20px");
//			.attr("fill","#B5B5B4");
			
	svg.append("text")
			.attr("class","text")
			.text("(shrinking, stretching or odd-looking value),")
			.attr("x",360)
			.attr("y",80)
			.attr("font-size","20px");
//			.attr("fill","#B5B5B4");
			
	svg.append("text")
			.attr("class","text")
			.text("press the ENTER key, SPACEBAR, or click your mouse")
			.attr("x",360)
			.attr("y",110)
			.attr("font-size","20px");
			

	svg.append("text")
			.attr("class","text")
			.text("Anomalies may be present in just one line,")
			.attr("x",360)
			.attr("y",180)
			.attr("font-size","20px");
			
	svg.append("text")
			.attr("class","text")
			.text("or in multiple lines at the same time.")
			.attr("x",360)
			.attr("y",210)
			.attr("font-size","20px");
			
	svg.append("text")
			.attr("class","text")
			.text("You need only respond")
			.attr("x",250)
			.attr("y",280)
			.attr("font-size","20px");
			
	svg.append("text")
			.attr("class","text")
			.text("ONCE per incident")
			.attr("x",475)
			.attr("y",280)
			.style("font-weight", "bold")
			.attr("font-size","20px");
			
			svg.append("text")
			.attr("class","text")
			.text("regardless of how many lines contain the anomaly.")
			.attr("x",360)
			.attr("y",310)
			.attr("font-size","20px");

//})
	
}
if (i == 4){
 	d3.tsv("data/caseTest1.tsv", type, function(error,data){
 	//console.log(dataSet);
 	var line = d3.svg.line()
 		.x(function(d,i){return x(d.index);})
 		.y(function(d,i){return y(d.value);})
 		.interpolate("cardinal");
 	var path = svg.append("g")
 		.attr("clip-path","url(#clip)")
 		//.attr("id","path")
 		.append("path")
 		.attr("transform","translate(0,0)")
 		.datum(data)
 		.attr("class","line")
 		.attr("id","line")
 		.attr("d",line)
 		.transition()
 		.duration(duration)
 		.ease("linear")
 		.attr("transform","translate("+x(-1999)+",0)");
 	})
 	d3.tsv("data/caseTest2.tsv", type, function(error,data){
 	//console.log(dataSet);
 	var line = d3.svg.line()
 		.x(function(d,i){return x(d.index);})
 		.y(function(d,i){return y(d.value);})
 		.interpolate("cardinal");
 	var path = svg.append("g")
 		.attr("clip-path","url(#clip)")
 		//.attr("id","path")
 		.append("path")
 		.attr("transform","translate(0,100)")
 		.datum(data)
 		.attr("class","line2")
 		.attr("id","line")
 		.attr("d",line)
 		.transition()
 		.duration(duration)
 		.ease("linear")
 		.attr("transform","translate("+x(-1999)+",0)");
 	})
 	d3.tsv("data/caseTest3.tsv", type, function(error,data){
 	//console.log(dataSet);
 	var line = d3.svg.line()
 		.x(function(d,i){return x(d.index);})
 		.y(function(d,i){return y(d.value);})
 		.interpolate("cardinal");
 	var path = svg.append("g")
 		.attr("clip-path","url(#clip)")
 		//.attr("id","path")
 		.append("path")
 		.attr("transform","translate(0,200)")
 		.datum(data)
 		.attr("class","line3")
 		.attr("d",line)
 		.transition()
 		.duration(duration)
 		.ease("linear")
 		.attr("transform","translate("+x(-1999)+",0)")
 		.style("stroke","brown");
 	})
  	svg.append("text")
  		.attr("class","text")
  		.attr("x",400)
 		.attr("y",400)
  		.attr("font-size","20px")
  		.attr("fill","black")
  		.text("During the experiment, you will be asked to monitor");
  	svg.append("text")
  		.attr("class","text")
  		.attr("x",400)
 		.attr("y",430)
  		.attr("font-size","20px")
  		.attr("fill","black")
  		.style("font-weight", "bold")
  		.text(" 3 lines simultaneously.");
  }
 	if (i == 6){
 	
 		d3.select("#container").attr("height", 200);
 		
 		svg.append("text")
 		.attr("class","text")
 		.attr("x",360)
 		.attr("y",100)
 		.attr("font-size","20px")
 		.attr("fill","black")
 		.text("Click NEXT to begin your test");
 		experimentr.showNext();
 		experimentr.release();
 	}

}
}
function type(d){
	d.index = d.index;
	d.value = d.value;
	return d;
}

</script>
</body>
